<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShiftWork AI Agent Test Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .test-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .test-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .test-card h3 {
            color: #4f46e5;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .test-card p {
            color: #666;
            margin-bottom: 20px;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #374151;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .btn {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 70, 229, 0.4);
        }
        
        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .results-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-top: 30px;
        }
        
        .results-section h3 {
            color: #4f46e5;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .result-item {
            background: #f8fafc;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #4f46e5;
        }
        
        .result-item.success {
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        
        .result-item.error {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        
        .result-item h4 {
            margin-bottom: 10px;
            color: #1f2937;
        }
        
        .result-item pre {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 12px;
            white-space: pre-wrap;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success { background: #10b981; }
        .status-error { background: #ef4444; }
        .status-pending { background: #f59e0b; }
        
        .server-status {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ ShiftWork AI Agent Test Interface</h1>
            <p>Test your ShiftWork HTTP MCP Server with AI agents</p>
        </div>
        
        <div class="server-status" id="serverStatus">
            <h3>Server Status: <span class="status-indicator status-pending"></span>Checking...</h3>
            <p id="serverInfo">Connecting to server...</p>
        </div>
        
        <div class="test-grid">
            <!-- Health Check Card -->
            <div class="test-card">
                <h3>üè• Health Check</h3>
                <p>Check if the ShiftWork server is running and healthy.</p>
                <button class="btn" onclick="runHealthCheck()">Check Server Health</button>
            </div>
            
            <!-- Ping Test Card -->
            <div class="test-card">
                <h3>üèì Ping Test</h3>
                <p>Test basic connectivity to the server.</p>
                <button class="btn" onclick="runPingTest()">Ping Server</button>
            </div>
            
            <!-- List Tools Card -->
            <div class="test-card">
                <h3>üõ†Ô∏è Available Tools</h3>
                <p>List all available MCP tools on the server.</p>
                <button class="btn" onclick="listTools()">List Tools</button>
            </div>
            
            <!-- Get Schedules Card -->
            <div class="test-card">
                <h3>üìÖ Get Employee Schedules</h3>
                <p>Retrieve schedules for a specific employee.</p>
                
                <div class="input-group">
                    <label for="companyId">Company ID:</label>
                    <input type="text" id="companyId" value="company123" placeholder="e.g., company123">
                </div>
                
                <div class="input-group">
                    <label for="personId">Employee ID:</label>
                    <input type="text" id="personId" value="employee456" placeholder="e.g., employee456">
                </div>
                
                <div class="input-group">
                    <label for="method">Method:</label>
                    <select id="method">
                        <option value="get">GET Request</option>
                        <option value="post">POST Request</option>
                        <option value="tool">Tool Execution</option>
                    </select>
                </div>
                
                <button class="btn" onclick="getSchedules()">Get Schedules</button>
            </div>
            
            <!-- Mock Email Card -->
            <div class="test-card">
                <h3>üìß Mock Email Test</h3>
                <p>Simulate sending a schedule email (no actual email sent).</p>
                
                <div class="input-group">
                    <label for="emailCompanyId">Company ID:</label>
                    <input type="text" id="emailCompanyId" value="company123" placeholder="e.g., company123">
                </div>
                
                <div class="input-group">
                    <label for="emailPersonId">Employee ID:</label>
                    <input type="text" id="emailPersonId" value="employee456" placeholder="e.g., employee456">
                </div>
                
                <div class="input-group">
                    <label for="recipientEmail">Recipient Email:</label>
                    <input type="email" id="recipientEmail" value="test@example.com" placeholder="test@example.com">
                </div>
                
                <div class="input-group">
                    <label for="employeeName">Employee Name (optional):</label>
                    <input type="text" id="employeeName" value="John Doe" placeholder="John Doe">
                </div>
                
                <button class="btn" onclick="mockEmail()">Generate Mock Email</button>
            </div>
            
            <!-- Comprehensive Test Card -->
            <div class="test-card">
                <h3>üß™ Comprehensive Test</h3>
                <p>Run all tests and generate a complete system report.</p>
                <button class="btn" onclick="runComprehensiveTest()">Run All Tests</button>
            </div>
        </div>
        
        <div class="results-section">
            <h3>Test Results</h3>
            <div id="results">
                <p style="color: #666; text-align: center;">No tests run yet. Click any test button above to start.</p>
            </div>
        </div>
    </div>

    <script>
        const SERVER_URL = 'http://localhost:8080';
        
        // Check server status on page load
        window.onload = function() {
            checkServerStatus();
        };
        
        async function checkServerStatus() {
            try {
                const response = await fetch(`${SERVER_URL}/health`);
                const data = await response.json();
                
                document.getElementById('serverStatus').innerHTML = `
                    <h3>Server Status: <span class="status-indicator status-success"></span>Online</h3>
                    <p id="serverInfo">Server is healthy and responding normally</p>
                `;
            } catch (error) {
                document.getElementById('serverStatus').innerHTML = `
                    <h3>Server Status: <span class="status-indicator status-error"></span>Offline</h3>
                    <p id="serverInfo">Cannot connect to server. Make sure it's running on ${SERVER_URL}</p>
                `;
            }
        }
        
        function addResult(title, data, isSuccess = true) {
            const resultsDiv = document.getElementById('results');
            const resultClass = isSuccess ? 'success' : 'error';
            
            const resultHtml = `
                <div class="result-item ${resultClass}">
                    <h4>${title}</h4>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
            
            if (resultsDiv.innerHTML.includes('No tests run yet')) {
                resultsDiv.innerHTML = resultHtml;
            } else {
                resultsDiv.innerHTML = resultHtml + resultsDiv.innerHTML;
            }
            
            // Scroll to results
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        async function makeRequest(endpoint, options = {}) {
            try {
                const response = await fetch(`${SERVER_URL}${endpoint}`, {
                    method: options.method || 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    body: options.body ? JSON.stringify(options.body) : undefined
                });
                
                const data = await response.json();
                return { success: response.ok, data, status: response.status };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
        
        async function runHealthCheck() {
            const result = await makeRequest('/health');
            addResult('üè• Health Check', result, result.success);
        }
        
        async function runPingTest() {
            const result = await makeRequest('/ping');
            addResult('üèì Ping Test', result, result.success);
        }
        
        async function listTools() {
            const result = await makeRequest('/api/tools');
            addResult('üõ†Ô∏è Available Tools', result, result.success);
        }
        
        async function getSchedules() {
            const companyId = document.getElementById('companyId').value;
            const personId = document.getElementById('personId').value;
            const method = document.getElementById('method').value;
            
            if (!companyId || !personId) {
                addResult('‚ùå Get Schedules', { error: 'Company ID and Person ID are required' }, false);
                return;
            }
            
            let result;
            if (method === 'get') {
                result = await makeRequest(`/api/employees/${companyId}/${personId}/schedules`);
            } else if (method === 'post') {
                result = await makeRequest('/api/employees/schedules', {
                    method: 'POST',
                    body: { company_id: companyId, person_id: personId }
                });
            } else if (method === 'tool') {
                result = await makeRequest('/api/tools/execute', {
                    method: 'POST',
                    body: {
                        tool_name: 'get_employee_schedules',
                        arguments: { company_id: companyId, person_id: personId }
                    }
                });
            }
            
            addResult(`üìÖ Get Schedules (${method.toUpperCase()})`, result, result.success);
        }
        
        async function mockEmail() {
            const companyId = document.getElementById('emailCompanyId').value;
            const personId = document.getElementById('emailPersonId').value;
            const recipientEmail = document.getElementById('recipientEmail').value;
            const employeeName = document.getElementById('employeeName').value;
            
            if (!companyId || !personId || !recipientEmail) {
                addResult('‚ùå Mock Email', { error: 'Company ID, Person ID, and Recipient Email are required' }, false);
                return;
            }
            
            // First get the schedules
            const scheduleResult = await makeRequest(`/api/employees/${companyId}/${personId}/schedules`);
            
            if (!scheduleResult.success) {
                addResult('üìß Mock Email', { 
                    error: 'Failed to get schedules',
                    details: scheduleResult
                }, false);
                return;
            }
            
            // Create mock email content
            const schedules = scheduleResult.data.schedules || [];
            const employeeDisplayName = employeeName || personId;
            const timestamp = new Date().toISOString();
            
            let emailBody;
            if (schedules.length > 0) {
                emailBody = `Subject: Work Schedule for ${employeeDisplayName}
From: system@shiftwork.com
To: ${recipientEmail}

Hello,

Here is the work schedule information for employee ${employeeDisplayName}:

Company ID: ${companyId}
Employee ID: ${personId}
Total Schedules: ${schedules.length}

Schedule Details:
`;
                schedules.forEach((schedule, i) => {
                    emailBody += `\n--- Schedule ${i + 1} ---\n`;
                    Object.entries(schedule).forEach(([key, value]) => {
                        emailBody += `${key}: ${value}\n`;
                    });
                    emailBody += '\n';
                });
                
                emailBody += `\nThis email was generated automatically on ${new Date().toLocaleString()}.\n\nBest regards,\nShiftWork Schedule System`;
            } else {
                emailBody = `Subject: Work Schedule for ${employeeDisplayName}
From: system@shiftwork.com
To: ${recipientEmail}

Hello,

No schedules found for employee ${employeeDisplayName} in company ${companyId}.

This email was generated automatically on ${new Date().toLocaleString()}.

Best regards,
ShiftWork Schedule System`;
            }
            
            const mockResult = {
                action: 'mock_email_send',
                company_id: companyId,
                person_id: personId,
                recipient_email: recipientEmail,
                employee_name: employeeDisplayName,
                schedules_found: schedules.length,
                email_content: emailBody,
                timestamp: timestamp,
                note: 'This is a mock email - no actual email was sent'
            };
            
            addResult('üìß Mock Email Generated', mockResult, true);
        }
        
        async function runComprehensiveTest() {
            const startTime = Date.now();
            const results = {
                timestamp: new Date().toISOString(),
                tests: {}
            };
            
            // Test 1: Health Check
            results.tests.health_check = await makeRequest('/health');
            
            // Test 2: Ping
            results.tests.ping = await makeRequest('/ping');
            
            // Test 3: List Tools
            results.tests.list_tools = await makeRequest('/api/tools');
            
            // Test 4: Schedule retrieval with different methods
            const testCases = [
                { company_id: 'company123', person_id: 'employee456' },
                { company_id: 'testcompany', person_id: 'testemployee' },
                { company_id: 'nonexistent', person_id: 'nobody' }
            ];
            
            results.tests.schedule_retrieval = {};
            
            for (const testCase of testCases) {
                const { company_id, person_id } = testCase;
                const key = `${company_id}_${person_id}`;
                
                // Test all three methods
                const getResult = await makeRequest(`/api/employees/${company_id}/${person_id}/schedules`);
                const postResult = await makeRequest('/api/employees/schedules', {
                    method: 'POST',
                    body: { company_id, person_id }
                });
                const toolResult = await makeRequest('/api/tools/execute', {
                    method: 'POST',
                    body: {
                        tool_name: 'get_employee_schedules',
                        arguments: { company_id, person_id }
                    }
                });
                
                results.tests.schedule_retrieval[key] = {
                    get_method: getResult,
                    post_method: postResult,
                    tool_method: toolResult
                };
            }
            
            // Test 5: Mock Email
            results.tests.mock_email = {
                note: 'Mock email test completed as part of comprehensive test',
                test_case: {
                    company_id: 'company123',
                    person_id: 'employee456',
                    recipient_email: 'test@example.com'
                }
            };
            
            // Calculate summary
            const endTime = Date.now();
            const duration = endTime - startTime;
            
            let totalTests = 0;
            let passedTests = 0;
            
            function countTests(obj) {
                if (typeof obj === 'object' && obj !== null) {
                    if ('success' in obj) {
                        totalTests++;
                        if (obj.success) passedTests++;
                    } else {
                        Object.values(obj).forEach(countTests);
                    }
                }
            }
            
            countTests(results.tests);
            
            results.summary = {
                duration_ms: duration,
                duration_seconds: (duration / 1000).toFixed(2),
                total_tests: totalTests,
                passed_tests: passedTests,
                failed_tests: totalTests - passedTests,
                success_rate: totalTests > 0 ? `${((passedTests / totalTests) * 100).toFixed(1)}%` : '0%',
                overall_status: passedTests === totalTests ? 'ALL_PASSED' : passedTests > 0 ? 'PARTIAL_SUCCESS' : 'ALL_FAILED'
            };
            
            addResult('üß™ Comprehensive Test Suite', results, passedTests > 0);
        }
        
        // Auto-refresh server status every 30 seconds
        setInterval(checkServerStatus, 30000);
    </script>
</body>
</html>