# Docker Compose for ShiftWork Mobile Development

version: '3.8'

services:
  mobile-dev:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: shiftwork-mobile-dev
    ports:
      - "8081:8081"   # Metro bundler
      - "19000:19000" # Expo DevTools
      - "19001:19001" # Expo DevTools WebSocket
      - "19002:19002" # Expo DevTools ngrok
    volumes:
      # Mount source code for hot reload
      - .:/app
      - /app/node_modules
      # Mount .env file
      - ./.env:/app/.env:ro
    environment:
      - NODE_ENV=development
      - EXPO_DEVTOOLS_LISTEN_ADDRESS=0.0.0.0
    networks:
      - shiftwork-network
    command: npm start -- --tunnel

  # Optional: Production web build
  mobile-web:
    build:
      context: .
      dockerfile: Dockerfile.prod
      args:
        API_URL: ${API_URL:-https://localhost:5001}
        FIREBASE_API_KEY: ${FIREBASE_API_KEY}
        FIREBASE_AUTH_DOMAIN: ${FIREBASE_AUTH_DOMAIN}
        FIREBASE_PROJECT_ID: ${FIREBASE_PROJECT_ID}
        FIREBASE_STORAGE_BUCKET: ${FIREBASE_STORAGE_BUCKET}
        FIREBASE_MESSAGING_SENDER_ID: ${FIREBASE_MESSAGING_SENDER_ID}
        FIREBASE_APP_ID: ${FIREBASE_APP_ID}
    container_name: shiftwork-mobile-web
    ports:
      - "3000:80"
    networks:
      - shiftwork-network
    profiles:
      - production

networks:
  shiftwork-network:
    external: true
    name: baseshiftwork_default
