<div class="dashboard-container">
  <mat-card class="dashboard-card">
    <mat-card-header>
      <mat-card-title>Tasks</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div *ngIf="loading" class="spinner-container">
        <mat-spinner></mat-spinner>
      </div>
      <div *ngIf="error" class="error-message">
        <mat-icon color="warn">error</mat-icon>
        Error loading tasks.
      </div>
      <div class="table-responsive">
        <table mat-table [dataSource]="tasks" class="mat-elevation-z2">

          <!-- Name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef> Name </th>
            <td mat-cell *matCellDef="let task"> {{ task.title }} </td>
          </ng-container>

          <!-- Description Column -->
          <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef> Description </th>
            <td mat-cell *matCellDef="let task"> {{ task.description }} </td>
          </ng-container>

          <!-- Location Column -->
          <ng-container matColumnDef="location">
            <th mat-header-cell *matHeaderCellDef> Location </th>
            <td mat-cell *matCellDef="let task"> {{ task.location?.name }} </td>
          </ng-container>

          <!-- Area Column -->
          <ng-container matColumnDef="area">
            <th mat-header-cell *matHeaderCellDef> Area </th>
            <td mat-cell *matCellDef="let task"> {{ task.area?.name }} </td>
          </ng-container>

          <!-- Person Column -->
          <ng-container matColumnDef="person">
            <th mat-header-cell *matHeaderCellDef> Person </th>
            <td mat-cell *matCellDef="let task"> {{ task.person?.name }} </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="['name', 'description', 'location', 'area', 'person']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['name', 'description', 'location', 'area', 'person'];"></tr>
        </table>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card class="dashboard-card">
    <mat-card-header>
      <mat-card-title>Create Task</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="taskForm" (ngSubmit)="createTask()">
        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Name</mat-label>
          <input matInput formControlName="name">
          <mat-error *ngIf="taskForm.get('name')?.invalid && taskForm.get('name')?.touched">
            Name is required.
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Description</mat-label>
          <textarea matInput formControlName="description"></textarea>
        </mat-form-field>

        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Location</mat-label>
          <mat-select formControlName="locationId">
            <mat-option *ngFor="let location of locations" [value]="location.locationId">
              {{ location.name }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="taskForm.get('locationId')?.invalid && taskForm.get('locationId')?.touched">
            Location is required.
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Area</mat-label>
          <mat-select formControlName="areaId">
            <mat-option *ngFor="let area of areas" [value]="area.areaId">
              {{ area.name }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="taskForm.get('areaId')?.invalid && taskForm.get('areaId')?.touched">
            Area is required.
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Person (Optional)</mat-label>
          <mat-select formControlName="personId">
            <mat-option value="">None</mat-option>
            <mat-option *ngFor="let person of people" [value]="person.personId">
              {{ person.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <button mat-raised-button color="primary" type="submit" [disabled]="!taskForm.valid">Create</button>
      </form>
    </mat-card-content>